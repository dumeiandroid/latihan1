<!-- 
  Nama File: index_read.html
  Fungsi: Mengambil dan menampilkan semua data dari API menggunakan metode GET.
  - Memuat data secara dinamis dari API.
  - Menampilkan data dalam tabel yang responsif.
  - Menggunakan Tailwind CSS untuk styling.
-->
<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manajemen Data - Tampilan Baca Saja</title>
    <!-- Tailwind CSS untuk styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome untuk ikon -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Font Inter dari Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .table-container { max-height: 70vh; overflow-y: auto; }
        .table-container::-webkit-scrollbar { height: 8px; }
        .table-container::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 10px; }
        .table-container::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
    </style>
</head>
<body class="bg-gray-100 p-8">
    <div class="container mx-auto">
        <div class="bg-white shadow-xl rounded-2xl overflow-hidden">
            <!-- Card Header -->
            <div class="bg-blue-600 text-white p-6 rounded-t-2xl flex items-center justify-between">
                <h4 class="text-2xl font-bold flex items-center">
                    <i class="fas fa-database mr-3"></i>
                    Tampilan Data - <span id="tableNameDisplay">data_latihan</span>
                </h4>
            </div>

            <!-- Card Body -->
            <div class="p-6">
                <!-- Loading & Error Message Container -->
                <div id="messageContainer" class="text-center text-gray-500 py-8 hidden">
                    <i class="fas fa-spinner fa-spin text-4xl mb-4"></i>
                    <p class="text-lg">Memuat data...</p>
                </div>

                <!-- Tabel Data -->
                <div id="tableContainer" class="table-container overflow-auto max-h-[70vh] rounded-xl shadow-inner">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-blue-800 sticky top-0 z-10">
                            <tr id="tableHeader"></tr>
                        </thead>
                        <tbody id="tableBody" class="bg-white divide-y divide-gray-200"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- Konfigurasi API ---
        const apiBaseUrl = 'https://lidan-co-id.pages.dev/api/contacts';
        const currentTable = 'data_latihan';

        document.addEventListener('DOMContentLoaded', () => {
            loadData();
        });

        /**
         * Memuat data dari API dan menampilkan di tabel.
         */
        async function loadData() {
            const messageContainer = document.getElementById('messageContainer');
            const tableContainer = document.getElementById('tableContainer');
            const tableHeader = document.getElementById('tableHeader');
            const tableBody = document.getElementById('tableBody');
            
            messageContainer.classList.remove('hidden');
            tableContainer.classList.add('hidden');
            tableHeader.innerHTML = '';
            tableBody.innerHTML = '';
            
            try {
                const response = await fetch(`${apiBaseUrl}?table=${currentTable}`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const result = await response.json();
                
                if (result.data && result.data.length > 0) {
                    renderTable(result.data);
                } else {
                    showMessage('Tidak ada data yang ditemukan.', 'warning');
                }
            } catch (error) {
                console.error('Error memuat data:', error);
                showMessage(`Error memuat data: ${error.message || error}`, 'danger');
            } finally {
                messageContainer.classList.add('hidden');
                tableContainer.classList.remove('hidden');
            }
        }

        /**
         * Merender data ke dalam tabel HTML.
         * @param {Array} data - Array data dari API.
         */
        function renderTable(data) {
            const tableHeader = document.getElementById('tableHeader');
            const tableBody = document.getElementById('tableBody');
            
            const headers = Object.keys(data[0]);
            
            let headerHtml = `<th class="px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider">ID</th>`;
            headers.filter(h => h !== 'id_x').forEach(header => {
                 headerHtml += `<th class="px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider">${header.toUpperCase()}</th>`;
            });
            tableHeader.innerHTML = headerHtml;

            data.forEach(item => {
                let rowHtml = `<tr class="hover:bg-gray-50 transition duration-150">`;
                rowHtml += `<td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${item.id_x}</td>`;
                headers.filter(h => h !== 'id_x').forEach(header => {
                    const value = item[header] !== undefined && item[header] !== null ? item[header] : '';
                    rowHtml += `<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${value}</td>`;
                });
                rowHtml += `</tr>`;
                tableBody.insertAdjacentHTML('beforeend', rowHtml);
            });
        }

        /**
         * Menampilkan pesan di kontainer utama saat memuat atau error.
         * @param {string} message - Pesan yang akan ditampilkan.
         * @param {string} type - Tipe pesan ('danger' atau 'warning').
         */
        function showMessage(message, type) {
            const messageContainer = document.getElementById('messageContainer');
            let iconHtml = '';
            let textColor = '';

            if (type === 'danger') {
                iconHtml = '<i class="fas fa-times-circle text-red-500 text-4xl mb-4"></i>';
                textColor = 'text-red-500';
            } else if (type === 'warning') {
                iconHtml = '<i class="fas fa-exclamation-triangle text-yellow-500 text-4xl mb-4"></i>';
                textColor = 'text-yellow-500';
            } else {
                iconHtml = '<i class="fas fa-info-circle text-gray-500 text-4xl mb-4"></i>';
                textColor = 'text-gray-500';
            }
            messageContainer.innerHTML = `${iconHtml}<p class="${textColor} text-lg">${message}</p>`;
            messageContainer.classList.remove('hidden');
        }
    </script>
</body>
</html>
