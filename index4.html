<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ujian Online - Peserta</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .chat-box { height: 200px; overflow-y: auto; border: 1px solid #ddd; padding: 10px; background: #f8f9fa; }
        .video-container { position: fixed; top: 10px; right: 10px; width: 200px; height: 150px; z-index: 1000; }
        #studentVideo { width: 100%; height: 100%; object-fit: cover; border: 2px solid #007bff; border-radius: 5px; }
        .exam-container { margin-right: 220px; }
    </style>
</head>
<body>
    <div class="container-fluid">
        <!-- Video Peserta -->
        <div class="video-container">
            <video id="studentVideo" autoplay muted></video>
            <audio id="studentAudio"></audio>
        </div>

        <div class="exam-container">
            <div class="row">
                <div class="col-md-8">
                    <div class="card">
                        <div class="card-header bg-primary text-white">
                            <h4>Ujian Online</h4>
                            <div id="timer" class="float-end">Waktu: 30:00</div>
                        </div>
                        <div class="card-body">
                            <form id="examForm">
                                <div class="question mb-4">
                                    <h5>1. Apa kepanjangan dari HTML?</h5>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="q1" value="a" id="q1a">
                                        <label class="form-check-label" for="q1a">HyperText Markup Language</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="q1" value="b" id="q1b">
                                        <label class="form-check-label" for="q1b">High Tech Modern Language</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="q1" value="c" id="q1c">
                                        <label class="form-check-label" for="q1c">Home Tool Markup Language</label>
                                    </div>
                                </div>

                                <div class="question mb-4">
                                    <h5>2. Tag HTML mana yang digunakan untuk membuat paragraf?</h5>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="q2" value="a" id="q2a">
                                        <label class="form-check-label" for="q2a">&lt;p&gt;</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="q2" value="b" id="q2b">
                                        <label class="form-check-label" for="q2b">&lt;paragraph&gt;</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="q2" value="c" id="q2c">
                                        <label class="form-check-label" for="q2c">&lt;text&gt;</label>
                                    </div>
                                </div>

                                <div class="question mb-4">
                                    <h5>3. CSS singkatan dari?</h5>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="q3" value="a" id="q3a">
                                        <label class="form-check-label" for="q3a">Cascading Style Sheets</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="q3" value="b" id="q3b">
                                        <label class="form-check-label" for="q3b">Computer Style Sheets</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="q3" value="c" id="q3c">
                                        <label class="form-check-label" for="q3c">Creative Style Sheets</label>
                                    </div>
                                </div>

                                <div class="question mb-4">
                                    <h5>4. JavaScript digunakan untuk?</h5>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="q4" value="a" id="q4a">
                                        <label class="form-check-label" for="q4a">Membuat halaman web interaktif</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="q4" value="b" id="q4b">
                                        <label class="form-check-label" for="q4b">Mendesain database</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="q4" value="c" id="q4c">
                                        <label class="form-check-label" for="q4c">Membuat server</label>
                                    </div>
                                </div>

                                <div class="question mb-4">
                                    <h5>5. Bootstrap adalah?</h5>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="q5" value="a" id="q5a">
                                        <label class="form-check-label" for="q5a">Framework CSS</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="q5" value="b" id="q5b">
                                        <label class="form-check-label" for="q5b">Bahasa pemrograman</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="q5" value="c" id="q5c">
                                        <label class="form-check-label" for="q5c">Database</label>
                                    </div>
                                </div>

                                <button type="submit" class="btn btn-success">Selesai Ujian</button>
                            </form>
                        </div>
                    </div>
                </div>

                <div class="col-md-4">
                    <!-- Chat -->
                    <div class="card">
                        <div class="card-header bg-info text-white">
                            <h6>Chat dengan Pengawas</h6>
                        </div>
                        <div class="card-body p-0">
                            <div id="chatMessages" class="chat-box"></div>
                            <div class="input-group mt-2">
                                <input type="text" id="messageInput" class="form-control" placeholder="Ketik pesan...">
                                <button id="sendMessage" class="btn btn-info">Kirim</button>
                            </div>
                        </div>
                    </div>

                    <!-- Audio dari Admin -->
                    <div class="card mt-3">
                        <div class="card-header bg-warning text-dark">
                            <h6>Audio Pengawas</h6>
                        </div>
                        <div class="card-body text-center">
                            <audio id="adminAudio" controls style="width: 100%;"></audio>
                            <div class="mt-2">
                                <button id="micBtn" class="btn btn-primary">ðŸŽ¤ Bicara</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script>
        let timeLeft = 1800; // 30 menit
        let mediaRecorder;
        let isRecording = false;
        let chatMessages = [];

        // Timer
        function updateTimer() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            $('#timer').text(`Waktu: ${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`);
            
            if (timeLeft <= 0) {
                alert('Waktu ujian habis!');
                $('#examForm').submit();
                return;
            }
            timeLeft--;
        }

        // Inisialisasi media
        async function initMedia() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
                $('#studentVideo')[0].srcObject = stream;
                
                mediaRecorder = new MediaRecorder(stream);
                mediaRecorder.ondataavailable = (event) => {
                    if (event.data.size > 0) {
                        // Kirim data audio ke admin (simulasi)
                        console.log('Audio data sent to admin');
                    }
                };
            } catch (err) {
                console.error('Error accessing media:', err);
                alert('Tidak dapat mengakses kamera/mikrofon. Ujian tidak dapat dilanjutkan.');
            }
        }

        // Chat functions
        function addMessage(sender, message, isAdmin = false) {
            const time = new Date().toLocaleTimeString();
            const messageClass = isAdmin ? 'text-danger' : 'text-primary';
            const messageHtml = `
                <div class="mb-2">
                    <small class="text-muted">${time}</small><br>
                    <strong class="${messageClass}">${sender}:</strong> ${message}
                </div>
            `;
            $('#chatMessages').append(messageHtml);
            $('#chatMessages').scrollTop($('#chatMessages')[0].scrollHeight);
            chatMessages.push({sender, message, time, isAdmin});
        }

        // Simulasi pesan dari admin
        function simulateAdminMessages() {
            setTimeout(() => {
                addMessage('Pengawas', 'Selamat mengerjakan ujian. Jika ada pertanyaan, silakan chat.', true);
            }, 5000);
            
            setTimeout(() => {
                addMessage('Pengawas', 'Pastikan kamera tetap menyala selama ujian.', true);
            }, 30000);
        }

        // Event listeners
        $(document).ready(function() {
            initMedia();
            setInterval(updateTimer, 1000);
            simulateAdminMessages();

            // Send chat message
            $('#sendMessage').click(function() {
                const message = $('#messageInput').val().trim();
                if (message) {
                    addMessage('Anda', message);
                    $('#messageInput').val('');
                    
                    // Simulasi balasan admin
                    setTimeout(() => {
                        const replies = [
                            'Terima kasih atas pertanyaannya.',
                            'Silakan lanjutkan mengerjakan.',
                            'Baik, saya mengerti.',
                            'Fokus pada ujian Anda.'
                        ];
                        const randomReply = replies[Math.floor(Math.random() * replies.length)];
                        addMessage('Pengawas', randomReply, true);
                    }, 1000 + Math.random() * 3000);
                }
            });

            $('#messageInput').keypress(function(e) {
                if (e.which === 13) {
                    $('#sendMessage').click();
                }
            });

            // Microphone button
            $('#micBtn').click(function() {
                if (!isRecording) {
                    mediaRecorder.start();
                    $(this).text('ðŸ”´ Berhenti').removeClass('btn-primary').addClass('btn-danger');
                    isRecording = true;
                } else {
                    mediaRecorder.stop();
                    $(this).text('ðŸŽ¤ Bicara').removeClass('btn-danger').addClass('btn-primary');
                    isRecording = false;
                }
            });

            // Submit exam
            $('#examForm').submit(function(e) {
                e.preventDefault();
                const answers = {};
                $('input[type="radio"]:checked').each(function() {
                    answers[$(this).attr('name')] = $(this).val();
                });
                
                const results = {
                    answers: answers,
                    chatHistory: chatMessages,
                    timeUsed: 1800 - timeLeft
                };
                
                console.log('Exam results:', results);
                alert('Ujian selesai! Hasil telah disimpan.');
            });
        });

        // Prevent tab switching/closing
        $(window).on('beforeunload', function() {
            return 'Ujian sedang berlangsung. Yakin ingin keluar?';
        });

        // Prevent right click
        $(document).on('contextmenu', function() {
            return false;
        });
    </script>
</body>
</html>