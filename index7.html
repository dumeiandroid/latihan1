<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRUD Data Latihan</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
</head>
<body>
    <div class="container mt-4">
        <h2>CRUD Data Latihan</h2>
        
        <!-- Form Input -->
        <div class="card mb-4">
            <div class="card-body">
                <form id="dataForm">
                    <input type="hidden" id="editId">
                    <div class="row">
                        <div class="col-md-4">
                            <input type="text" class="form-control" id="name" placeholder="Nama" required>
                        </div>
                        <div class="col-md-4">
                            <input type="email" class="form-control" id="email" placeholder="Email" required>
                        </div>
                        <div class="col-md-4">
                            <input type="text" class="form-control" id="message" placeholder="Pesan" required>
                        </div>
                    </div>
                    <div class="mt-3">
                        <button type="submit" id="submitBtn" class="btn btn-primary">Tambah Data</button>
                        <button type="button" id="cancelBtn" class="btn btn-secondary d-none">Batal</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Data Table -->
        <div class="card">
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nama</th>
                                <th>Email</th>
                                <th>Pesan</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="dataTable">
                            <!-- Data akan dimuat di sini -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = '/api/contacts'; // Ganti dengan endpoint yang sesuai
        let editMode = false;

        // Load data saat halaman dimuat
        $(document).ready(function() {
            loadData();
        });

        // Load semua data
        function loadData() {
            $.get(API_BASE)
                .done(function(data) {
                    let html = '';
                    data.forEach(function(item) {
                        html += `
                            <tr>
                                <td>${item.id}</td>
                                <td>${item.name}</td>
                                <td>${item.email}</td>
                                <td>${item.message}</td>
                                <td>
                                    <button class="btn btn-sm btn-warning" onclick="editData(${item.id}, '${item.name}', '${item.email}', '${item.message}')">Edit</button>
                                    <button class="btn btn-sm btn-danger" onclick="deleteData(${item.id})">Hapus</button>
                                </td>
                            </tr>
                        `;
                    });
                    $('#dataTable').html(html);
                })
                .fail(function() {
                    alert('Gagal memuat data');
                });
        }

        // Submit form (Create/Update)
        $('#dataForm').submit(function(e) {
            e.preventDefault();
            
            const data = {
                name: $('#name').val(),
                email: $('#email').val(),
                message: $('#message').val()
            };

            if (editMode) {
                // Update
                const id = $('#editId').val();
                $.ajax({
                    url: `${API_BASE}/${id}`,
                    method: 'PUT',
                    contentType: 'application/json',
                    data: JSON.stringify(data)
                })
                .done(function() {
                    alert('Data berhasil diupdate');
                    resetForm();
                    loadData();
                })
                .fail(function() {
                    alert('Gagal mengupdate data');
                });
            } else {
                // Create
                $.ajax({
                    url: API_BASE,
                    method: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify(data)
                })
                .done(function() {
                    alert('Data berhasil ditambahkan');
                    resetForm();
                    loadData();
                })
                .fail(function() {
                    alert('Gagal menambahkan data');
                });
            }
        });

        // Edit data
        function editData(id, name, email, message) {
            editMode = true;
            $('#editId').val(id);
            $('#name').val(name);
            $('#email').val(email);
            $('#message').val(message);
            $('#submitBtn').text('Update Data').removeClass('btn-primary').addClass('btn-warning');
            $('#cancelBtn').removeClass('d-none');
        }

        // Delete data
        function deleteData(id) {
            if (confirm('Yakin ingin menghapus data ini?')) {
                $.ajax({
                    url: `${API_BASE}/${id}`,
                    method: 'DELETE'
                })
                .done(function() {
                    alert('Data berhasil dihapus');
                    loadData();
                })
                .fail(function() {
                    alert('Gagal menghapus data');
                });
            }
        }

        // Cancel edit
        $('#cancelBtn').click(function() {
            resetForm();
        });

        // Reset form
        function resetForm() {
            editMode = false;
            $('#dataForm')[0].reset();
            $('#editId').val('');
            $('#submitBtn').text('Tambah Data').removeClass('btn-warning').addClass('btn-primary');
            $('#cancelBtn').addClass('d-none');
        }
    </script>
</body>
</html>